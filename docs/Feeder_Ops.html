---

title: Feeder Ops

keywords: fastai
sidebar: home_sidebar

summary: "Functions for controlling the feeding machine"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_Feeder_Ops.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="logging">logging<a class="anchor-link" href="#logging">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TlsSMTPHandler" class="doc_header"><code>class</code> <code>TlsSMTPHandler</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L56" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TlsSMTPHandler</code>(<strong><code>mailhost</code></strong>, <strong><code>fromaddr</code></strong>, <strong><code>toaddrs</code></strong>, <strong><code>subject</code></strong>, <strong><code>credentials</code></strong>=<em><code>None</code></em>, <strong><code>secure</code></strong>=<em><code>None</code></em>, <strong><code>timeout</code></strong>=<em><code>5.0</code></em>) :: <code>SMTPHandler</code></p>
</blockquote>
<p>A handler class which sends an SMTP email for each logging event.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">log_test</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">log_test</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mail_handler</span> <span class="o">=</span> <span class="n">TlsSMTPHandler</span><span class="p">((</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">587</span><span class="p">),</span> <span class="s1">&#39;bugs@my_company.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;admin@my_company.com&#39;</span><span class="p">],</span> <span class="s1">&#39;Error found!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;my_company_account@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;top_secret_gmail_password&#39;</span><span class="p">))</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>


<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> p</span><span class="si">%(process)s</span><span class="s1"> {</span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">} </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">log_test</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>


<span class="n">log_test</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>--- Logging error ---
Traceback (most recent call last):
  File &#34;&lt;ipython-input-4-beed5dd327d4&gt;&#34;, line 16, in emit
    contents=msg)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/yagmail/sender.py&#34;, line 147, in send
    self.login()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/yagmail/sender.py&#34;, line 246, in login
    self._login(self.credentials)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/yagmail/sender.py&#34;, line 204, in _login
    self.smtp.login(self.user, password)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/smtplib.py&#34;, line 730, in login
    raise last_exception
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/smtplib.py&#34;, line 721, in login
    initial_response_ok=initial_response_ok)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/smtplib.py&#34;, line 642, in auth
    raise SMTPAuthenticationError(code, resp)
smtplib.SMTPAuthenticationError: (535, b&#39;5.7.8 Username and Password not accepted. Learn more at\n5.7.8  https://support.google.com/mail/?p=BadCredentials e5sm2644850ejb.26 - gsmtp&#39;)
Call stack:
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/runpy.py&#34;, line 193, in _run_module_as_main
    &#34;__main__&#34;, mod_spec)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/runpy.py&#34;, line 85, in _run_code
    exec(code, run_globals)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel_launcher.py&#34;, line 16, in &lt;module&gt;
    app.launch_new_instance()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/traitlets/config/application.py&#34;, line 664, in launch_instance
    app.start()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/kernelapp.py&#34;, line 583, in start
    self.io_loop.start()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/platform/asyncio.py&#34;, line 153, in start
    self.asyncio_loop.run_forever()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/asyncio/base_events.py&#34;, line 534, in run_forever
    self._run_once()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/asyncio/base_events.py&#34;, line 1771, in _run_once
    handle._run()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/asyncio/events.py&#34;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/ioloop.py&#34;, line 690, in &lt;lambda&gt;
    lambda f: self._run_callback(functools.partial(callback, future))
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/ioloop.py&#34;, line 743, in _run_callback
    ret = callback()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/gen.py&#34;, line 787, in inner
    self.run()
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/gen.py&#34;, line 748, in run
    yielded = self.gen.send(value)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/kernelbase.py&#34;, line 361, in process_one
    yield gen.maybe_future(dispatch(*args))
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/gen.py&#34;, line 209, in wrapper
    yielded = next(result)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/kernelbase.py&#34;, line 268, in dispatch_shell
    yield gen.maybe_future(handler(stream, idents, msg))
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/gen.py&#34;, line 209, in wrapper
    yielded = next(result)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/kernelbase.py&#34;, line 541, in execute_request
    user_expressions, allow_stdin,
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/tornado/gen.py&#34;, line 209, in wrapper
    yielded = next(result)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/ipkernel.py&#34;, line 300, in do_execute
    res = shell.run_cell(code, store_history=store_history, silent=silent)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/ipykernel/zmqshell.py&#34;, line 536, in run_cell
    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/interactiveshell.py&#34;, line 2858, in run_cell
    raw_cell, store_history, silent, shell_futures)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/interactiveshell.py&#34;, line 2886, in _run_cell
    return runner(coro)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/async_helpers.py&#34;, line 68, in _pseudo_sync_runner
    coro.send(None)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/interactiveshell.py&#34;, line 3063, in run_cell_async
    interactivity=interactivity, compiler=compiler, result=result)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/interactiveshell.py&#34;, line 3254, in run_ast_nodes
    if (await self.run_code(code, result,  async_=asy)):
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/site-packages/IPython/core/interactiveshell.py&#34;, line 3331, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File &#34;&lt;ipython-input-5-be29cfea4619&gt;&#34;, line 14, in &lt;module&gt;
    log_test.error(&#34;test&#34;)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/logging/__init__.py&#34;, line 1407, in error
    self._log(ERROR, msg, args, **kwargs)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/logging/__init__.py&#34;, line 1514, in _log
    self.handle(record)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/logging/__init__.py&#34;, line 1524, in handle
    self.callHandlers(record)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/logging/__init__.py&#34;, line 1586, in callHandlers
    hdlr.handle(record)
  File &#34;/home/wilhelm/miniconda3/envs/PooDetector/lib/python3.7/logging/__init__.py&#34;, line 894, in handle
    self.emit(record)
  File &#34;&lt;ipython-input-4-beed5dd327d4&gt;&#34;, line 20, in emit
    self.handleError(record)
Message: &#39;test&#39;
Arguments: ()
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_logger" class="doc_header"><code>get_logger</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_logger</code>(<strong><code>log_file</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Initialize global logger and return it.</p>
<p>:param log_file: log to this file, or to standard output if None
:return: created logger</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_folder" class="doc_header"><code>create_folder</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_folder</code>(<strong><code>path</code></strong>:<code>Path</code>, <strong><code>foldername</code></strong>)</p>
</blockquote>
<p>creates a folder if it does not exist already</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">PATH_MODEL</span><span class="p">)</span>
<span class="c1">#model.predict(open_image(&#39;data/horse_poo/20181215091846-poo_day.jpg&#39;))[2][0].numpy() &gt; 0</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_sunrise" class="doc_header"><code>get_sunrise</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L125" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_sunrise</code>()</p>
</blockquote>
<p>gets the sunrise as an int</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_sunset" class="doc_header"><code>get_sunset</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L132" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_sunset</code>()</p>
</blockquote>
<p>gets the sunset as an int</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_sunrise</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>753</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="main-function">main function<a class="anchor-link" href="#main-function">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="send_mail_with_pic" class="doc_header"><code>send_mail_with_pic</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L139" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>send_mail_with_pic</code>(<strong><code>image</code></strong>:<code>Path'&gt;]</code>)</p>
</blockquote>
<p>send a mail with an embedded picture</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;test_data/no_horse_poo/20181215105642-poo_day.jpg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">send_mail_with_pic</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_feeder" class="doc_header"><code>run_feeder</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L150" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_feeder</code>()</p>
</blockquote>
<p>runs feeder</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_feeder</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">folder</span> <span class="o">=</span> <span class="n">create_folder</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">PATH_FOLDER_SUCCESSFUL_PREDICTIONS</span><span class="p">),</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cap_and_predict" class="doc_header"><code>cap_and_predict</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cap_and_predict</code>()</p>
</blockquote>
<p>this function captures camera pictures. To configure this function please use a .env file</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#from nbdev.export import *</span>
<span class="c1">#notebook2script(&#39;04_Feeder_Ops.ipynb&#39;)</span>
<span class="c1">#notebook2script()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 04_Feeder_Ops.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

