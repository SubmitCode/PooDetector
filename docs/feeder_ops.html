---

title: Feeder Ops


keywords: fastai
sidebar: home_sidebar

summary: "Functions for controlling the feeding machine"
description: "Functions for controlling the feeding machine"
nb_path: "nbs/04_feeder_ops.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_feeder_ops.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="logging">logging<a class="anchor-link" href="#logging"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TlsSMTPHandler" class="doc_header"><code>class</code> <code>TlsSMTPHandler</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L66" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TlsSMTPHandler</code>(<strong><code>mailhost</code></strong>, <strong><code>fromaddr</code></strong>, <strong><code>toaddrs</code></strong>, <strong><code>subject</code></strong>, <strong><code>credentials</code></strong>=<em><code>None</code></em>, <strong><code>secure</code></strong>=<em><code>None</code></em>, <strong><code>timeout</code></strong>=<em><code>5.0</code></em>) :: <code>SMTPHandler</code></p>
</blockquote>
<p>A handler class which sends an SMTP email for each logging event.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">log_test</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">log_test</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mail_handler</span> <span class="o">=</span> <span class="n">TlsSMTPHandler</span><span class="p">((</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">587</span><span class="p">),</span> <span class="s1">&#39;bugs@my_company.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;admin@my_company.com&#39;</span><span class="p">],</span> <span class="s1">&#39;Error found!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;my_company_account@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;top_secret_gmail_password&#39;</span><span class="p">))</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>


<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> p</span><span class="si">%(process)s</span><span class="s1"> {</span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">} </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">log_test</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>


<span class="n">log_test</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_logger" class="doc_header"><code>get_logger</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L88" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_logger</code>(<strong><code>log_file</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Initialize global logger and return it.</p>
<p>:param log_file: log to this file, or to standard output if None
:return: created logger</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_folder" class="doc_header"><code>create_folder</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_folder</code>(<strong><code>path</code></strong>:<code>Path</code>, <strong><code>foldername</code></strong>)</p>
</blockquote>
<p>creates a folder if it does not exist already</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">PATH_MODEL</span><span class="p">)</span>
<span class="c1">#model.predict(open_image(&#39;data/horse_poo/20181215091846-poo_day.jpg&#39;))[2][0].numpy() &gt; 0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_sunrise" class="doc_header"><code>get_sunrise</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L135" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_sunrise</code>()</p>
</blockquote>
<p>gets the sunrise as an int</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_sunset" class="doc_header"><code>get_sunset</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L142" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_sunset</code>()</p>
</blockquote>
<p>gets the sunset as an int</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_sunrise</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>805</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="main-function">main function<a class="anchor-link" href="#main-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="send_mail_with_pic" class="doc_header"><code>send_mail_with_pic</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L149" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>send_mail_with_pic</code>(<strong><code>image</code></strong>:<code>Path'&gt;]</code>)</p>
</blockquote>
<p>send a mail with an embedded picture</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;test_data/no_horse_poo/20181215105642-poo_day.jpg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">send_mail_with_pic</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_feeder" class="doc_header"><code>run_feeder</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L160" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_feeder</code>()</p>
</blockquote>
<p>runs feeder</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_feeder</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Influx-setup">Influx setup<a class="anchor-link" href="#Influx-setup"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>docker run -v $PWD:/var/lib/influxdb --name influxdb -d -p 8086:8086 quay.io/influxdb/influxdb:v2.0.3</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_influx_api" class="doc_header"><code>get_influx_api</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L172" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_influx_api</code>()</p>
</blockquote>
<p>returns influx write_api</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">write_api</span> <span class="o">=</span> <span class="n">get_influx_api</span><span class="p">()</span>
<span class="n">write_api</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;influxdb_client.client.write_api.WriteApi at 0x7fa986a1add0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_to_influx" class="doc_header"><code>write_to_influx</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L182" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_to_influx</code>(<strong><code>path</code></strong>:<code>Path</code>, <strong><code>accuracy</code></strong>, <strong><code>write_api</code></strong>)</p>
</blockquote>
<p>write datapoint to influx</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">write_to_influx</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/test.jpg&quot;</span><span class="p">),</span> <span class="mf">0.938</span><span class="p">,</span> <span class="n">write_api</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cap_and_predict" class="doc_header"><code>cap_and_predict</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/feeder_ops.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cap_and_predict</code>()</p>
</blockquote>
<p>this function captures camera pictures. To configure this function please use a .env file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">(</span><span class="s1">&#39;04_feeder_ops.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 04_feeder_ops.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

