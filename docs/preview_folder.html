---

title: Preview Folder


keywords: fastai
sidebar: home_sidebar

summary: "This model takes pictures every x minutes and saves them in a separate folder and also organizes pictures in different folders"
description: "This model takes pictures every x minutes and saves them in a separate folder and also organizes pictures in different folders"
nb_path: "nbs/05_preview_folder.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_preview_folder.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_path_timestamp" class="doc_header"><code>convert_path_timestamp</code><a href="https://github.com/submitCode/PooDetector/tree/master/PooDetector/preview_folder.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_path_timestamp</code>(<strong><code>path</code></strong>:<code>Path'&gt;]</code>)</p>
</blockquote>
<p>converts a filename to timestamp</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200320/20200320062300_006411.jpg&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">convert_path_timestamp</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="ow">is</span> <span class="n">datetime</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-10-5e945249bcb4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> path <span class="ansi-blue-fg">=</span> Path<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;data/to_label/20200320/20200320062300_006411.jpg&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">assert</span> type<span class="ansi-blue-fg">(</span>convert_path_timestamp<span class="ansi-blue-fg">(</span>path<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span> datetime

<span class="ansi-red-fg">AssertionError</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_filename_df</span><span class="p">(</span><span class="n">path_folder</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;converts image filepaths to a pandas df&quot;&quot;&quot;</span>
    <span class="n">path_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path_folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*.jpg&#39;</span><span class="p">))</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="n">datehour</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="n">paths_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_path_timestamp</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span><span class="n">paths</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span><span class="n">dates</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">:</span><span class="n">hour</span><span class="p">,</span> <span class="s2">&quot;datehour&quot;</span><span class="p">:</span> <span class="n">datehour</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">paths_times</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_filename_df</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200320/&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="k">assert</span> <span class="s1">&#39;datehour&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Empty DataFrame
Columns: [path, date, hour, datehour]
Index: []
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_datehour_folders</span><span class="p">(</span><span class="n">path</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">df</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;create a folder for every datehour combination in the dataframe&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;datehour&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">datehour</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">datehour</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;create folder </span><span class="si">{datehour}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">datehour</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/to_label/&#39;</span><span class="p">)</span>
<span class="n">create_datehour_folders</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">datehour</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">datehour</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">t_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">datehour</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">t_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="n">t_path</span><span class="o">.</span><span class="n">rmdir</span><span class="p">()</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">move_files</span><span class="p">(</span><span class="n">df</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">path</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;move files from source folder to target folder&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">path_source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
        <span class="n">path_dest</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;datehour&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path_source</span><span class="o">.</span><span class="n">name</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path_source</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">path_dest</span><span class="p">))</span>
        <span class="c1">#print(f&quot;move from {path_source} to {path_dest}&quot;)</span>
        
<span class="k">def</span> <span class="nf">remove_folder</span><span class="p">(</span><span class="n">path</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;removes folder and all files and folders within&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">child</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rm_tree</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="n">path</span><span class="o">.</span><span class="n">rmdir</span><span class="p">()</span>
        
<span class="k">def</span> <span class="nf">to_hour_folder</span><span class="p">(</span><span class="n">path_source</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;moves files from daily folder to hourly folders&quot;&quot;&quot;</span>
    <span class="n">path_source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_source</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_filename_df</span><span class="p">(</span><span class="n">path_source</span><span class="p">)</span>
    <span class="n">create_datehour_folders</span><span class="p">(</span><span class="n">path_source</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="n">move_files</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path_source</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">remove_folder</span><span class="p">(</span><span class="n">path_source</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls data/to_label/
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>20200328  20200330  20200401  20200403	auswahl  special2
20200329  20200331  20200402  20200404	special
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200328/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200329/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200330/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200331/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200401/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200402/&#39;</span><span class="p">)</span>
<span class="n">to_hour_folder</span><span class="p">(</span><span class="s1">&#39;data/to_label/20200403/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create folder 2020032806
create folder 2020032807
create folder 2020032808
create folder 2020032809
create folder 2020032810
create folder 2020032811
create folder 2020032812
create folder 2020032813
create folder 2020032815
create folder 2020032816
create folder 2020032817
create folder 2020032818
create folder 2020032907
create folder 2020032908
create folder 2020032909
create folder 2020032910
create folder 2020032911
create folder 2020032912
create folder 2020032913
create folder 2020032914
create folder 2020032915
create folder 2020032916
create folder 2020032917
create folder 2020032918
create folder 2020032919
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Export">Export<a class="anchor-link" href="#Export"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_dataset_operations.ipynb.
Converted 01_custom_receipe.ipynb.
Converted 02_capture_camera.ipynb.
Converted 03_binaryHorsePoo.ipynb.
Converted 04_feeder_ops.ipynb.
Converted 05_preview_folder.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

